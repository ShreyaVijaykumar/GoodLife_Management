{% extends "base.html" %}

{% block content %}
<h2>Donation Monitor</h2>

<div class="tab-nav">
    <a href="#form" class="active" onclick="showTab(event, 'form')">Donation Entry Form</a>
    <a href="#data" onclick="showTab(event, 'data')">Donation History</a>
</div>

<div id="form" class="tab-content">
    <form method="POST">
        <label>Donor Name:</label>
        <input type="text" name="donor_name" required>

        <label>Amount:</label>
        <input type="number" name="amount" step="0.01" min="0.01" required>

        <label>Items Donated (Optional):</label>
        <textarea name="items_donated"></textarea>

        <label>Payment Mode:</label>
        <select name="payment_mode" required>
            <option value="">Select Payment Mode</option>
            <option value="Cash">Cash</option>
            <option value="Card">Card</option>
            <option value="UPI">UPI</option>
            <option value="Other">Other</option>
        </select>

        <label>Payment Details (Optional):</label>
        <input type="text" name="payment_detail">

        <button type="submit">Submit Donation</button>
    </form>
</div>

<div id="data" class="tab-content" style="display: none;">
    
    <div class="filter-nav">
        <a href="?filter=today" class="{% if current_filter == 'today' %}active{% endif %}">Today</a>
        <a href="?filter=yesterday" class="{% if current_filter == 'yesterday' %}active{% endif %}">Yesterday</a>
        <a href="?filter=year" class="{% if current_filter == 'year' %}active{% endif %}">This Year</a>
        <a href="?filter=all" class="{% if current_filter == 'all' %}active{% endif %}">All Time</a>
    </div>
    
    <table class="data-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Donor Name</th>
                <th>Amount</th>
                <th>Items</th>
                <th>Payment Mode</th>
            </tr>
        </thead>
        <tbody>
            {% for donation in donations %}
            <tr>
                <td>{{ donation.donation_date }}</td>
                <td>{{ donation.donation_time }}</td>
                <td>{{ donation.donor_name }}</td>
                <td class="amount">â‚¹{{ "%.2f"|format(donation.amount) }}</td>
                <td>{{ donation.items_donated or 'N/A' }}</td>
                <td>{{ donation.payment_mode }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" style="text-align: center; padding: 2rem;">No donations found for this period.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function showTab(evt, tabName) {
        var i, tabcontent;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        var tablinks = document.getElementsByClassName("tab-nav")[0].getElementsByTagName("a");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
    }
    
    // Check URL to see if we should open the 'data' tab
    if (window.location.search.includes("filter=")) {
        showTab({currentTarget: document.querySelector('.tab-nav a[href="#data"]')}, 'data');
    } else {
        document.getElementById("form").style.display = "block";
    }
</script>
{% endblock %}